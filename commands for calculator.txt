# Install 7-Zip Silently
Write-Host "Installing 7-Zip..."
Start-Process msiexec.exe -ArgumentList "/i C:\Lab\7zip.msi /qn" -Wait

# Verify it exists (Registry Check)
Get-Package -Name "7-Zip*" | Select-Object Name, ProviderName

# Uninstall 7-Zip (We find the IdentifyingNumber/GUID first)
$App = Get-WmiObject Win32_Product | Where-Object { $_.Name -match "7-Zip" }
Write-Host "Uninstalling $($App.Name)..."
Start-Process msiexec.exe -ArgumentList "/x $($App.IdentifyingNumber) /qn" -Wait




# 1. Create the dummy script
Set-Content -Path "C:\Lab\script.cmd" -Value "echo Active Setup Ran > C:\Users\Public\AS_Log.txt"

# 2. Create the Registry Key
New-Item -Path "HKLM:\Software\Microsoft\Active Setup\Installed Components\TestApp" -Force

# 3. Set the StubPath (The command to run)
Set-ItemProperty -Path "HKLM:\Software\Microsoft\Active Setup\Installed Components\TestApp" -Name "StubPath" -Value "C:\Lab\script.cmd"





# Create a dummy file
New-Item "C:\Lab\file.txt" -ItemType File -Force

# Copy, Move, Delete
Copy-Item "C:\Lab\file.txt" "C:\Windows\Temp\"
Move-Item "C:\Windows\Temp\file.txt" "C:\Lab\file_moved.txt"
Remove-Item "C:\Lab\file.txt"

# Registry Creation & Deletion
New-Item -Path "HKLM:\Software\TestApp" -Force
Set-ItemProperty -Path "HKLM:\Software\TestApp" -Name "Version" -Value "1.0"
Remove-Item "HKLM:\Software\TestApp" -Recurse




# Restart the Spooler service
Stop-Service spooler
Start-Service spooler

# Kill the Notepad we started earlier

Stop-Process -Name notepad -Force



<#
.SYNOPSIS
  This is a simplified Lab version of the Deploy-Application script.
#>

# --- THE FIX: Load the Windows Forms Library first ---
Add-Type -AssemblyName System.Windows.Forms

##*===============================================
##* VARIABLE DECLARATION
##*===============================================
## Variables: Application
[String]$appVendor = '7-Zip'
[String]$appName = '7-Zip File Manager'
[String]$appVersion = '23.01'
[String]$appArch = 'x64'
[String]$appLang = 'EN'
[String]$appRevision = '01'
[String]$appScriptVersion = '1.0.0'
[String]$appScriptDate = '02/13/2026'
[String]$appScriptAuthor = 'Student Lab'

##*===============================================
##* INSTALLATION LOGIC
##*===============================================

# Define the folder path
$dirFiles = "$PSScriptRoot\Files"

# 1. Show Welcome Message (Simulated)
# Now that we loaded the assembly at the top, this will work!
[System.Windows.Forms.MessageBox]::Show("Welcome to the installation of $appName", "Installation")

# 2. Perform Installation
# We create a fake 'Execute-MSI' function so the command works like the real toolkit
function Execute-MSI {
    param([string]$Action, [string]$Path)
    Write-Host "Executing MSI: $Path" -ForegroundColor Cyan
    Start-Process msiexec.exe -ArgumentList "/i `"$Path`" /qn" -Wait
}

# --- THIS IS THE LINE YOUR INSTRUCTOR WANTS ---
# Ensure your 7zip.msi is actually in the C:\PSLab\Toolkit\Files folder!
Execute-MSI -Action 'Install' -Path "$dirFiles\7zip.msi"

# 3. Finish
Write-Host "Installation Complete." -ForegroundColor Green


